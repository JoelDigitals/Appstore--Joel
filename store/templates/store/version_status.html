{% extends "base.html" %}
{% load static %}

{% block title %}Status der App-PrÃ¼fung{% endblock %}

{% block content %}
<div class="container my-5 text-white">
  <h1 class="text-center mb-4">Statusanzeige der App-PrÃ¼fung</h1>

  <div class="step" id="step-file">
    <p>ğŸ“ Datei-Upload abgeschlossen.</p>
  </div>
  <div class="step" id="step-structure">
    <p>ğŸ§© StrukturprÃ¼fung lÃ¤uft...</p>
  </div>
  <div class="step" id="step-security">
    <p>ğŸ”’ SicherheitsprÃ¼fung lÃ¤uft...</p>
  </div>
  <div class="step" id="step-quality">
    <p>ğŸ§ª QualitÃ¤tsprÃ¼fung lÃ¤uft...</p>
  </div>
  <div class="step" id="step-release">
    <p>ğŸš€ VerÃ¶ffentlichung wird vorbereitet...</p>
  </div>

  <div class="games-link text-center">
    <p class="mt-4">Du wartest? Zeit fÃ¼r eine Runde!</p>
    <div class="d-flex flex-wrap justify-content-center gap-2">
      <a href="{% static 'games/tetris.html' %}" target="_blank" class="btn btn-outline-light">ğŸ® Tetris</a>
      <a href="{% static 'games/pong.html' %}" target="_blank" class="btn btn-outline-light">ğŸ“ Pong</a>
      <a href="{% static 'games/flappy.html' %}" target="_blank" class="btn btn-outline-light">ğŸ¤ Flappy Bird</a>
      <a href="{% static 'games/2048.html' %}" target="_blank" class="btn btn-outline-light">2048</a>
      <a href="{% static 'games/blockblast.html' %}" target="_blank" class="btn btn-outline-light">ğŸ¨ BlockBlast</a>
      <a href="{% static 'games/snake.html' %}" target="_blank" class="btn btn-outline-light">ğŸ Snake</a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Starte nach kurzer Wartezeit die Live-Status-PrÃ¼fung
  setTimeout(() => checkStatus(), 500);

  function checkStatus() {
    fetch("{% url 'version_status_api' version.id %}")
      .then(response => response.json())
      .then(data => {
        if (data.status === 'passed') {
          document.querySelectorAll('.step').forEach(el => {
            el.classList.add('completed');
          });
          document.getElementById('step-release').innerHTML =
            "<p>âœ… VerÃ¶ffentlichung abgeschlossen.</p>";
        } else if (data.status === 'running') {
          // Optional: dynamisch laufende Steps updaten
          console.log("PrÃ¼fung lÃ¤uft noch...");
          setTimeout(checkStatus, 5000);  // alle 5s neu prÃ¼fen
        }
      });
  }
});
</script>

<style>
.step {
  margin: 20px 0;
  padding: 15px;
  background: #222;
  border-left: 5px solid #555;
  border-radius: 5px;
  transition: background 0.3s, border-left 0.3s;
}
.step.completed {
  background: #2d2;
  border-left-color: #4f4;
}
.step p {
  margin: 0;
}
</style>
{% endblock %}
